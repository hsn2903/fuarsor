// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  // posts         Post[]
  emailVerified Boolean   @default(false)
  image         String?
  paymentMethod String?
  phone         String?
  role          String    @default("USER") // USER, ADMIN, EDITOR
  banned        Boolean   @default(false)
  banReason     String?
  banExpires    DateTime?

  // Custom E-commerce Fields
  phoneNumber String?
  address     String? @db.Text

  // --- NEW FIELDS ---
  bio      String? @db.Text
  jobTitle String?
  website  String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sessions Session[]
  accounts Account[]

  @@map("users")
}

model Post {
  id         String  @id @default(cuid())
  title      String
  slug       String  @unique
  content    String?
  coverImage String?
  published  Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  category  String?  @default("Diğer")

  @@map("posts")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("sessions")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("accounts")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verifications")
}

// --- 1. INDEPENDENT LIBRARIES ---

model Hotel {
  id          String   @id @default(uuid())
  name        String
  description String?
  imageUrls   String[] // Array of Cloudinary URLs

  // Relation: A hotel can be used by many Fairs
  fairs Fair[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Gallery {
  id          String   @id @default(uuid())
  name        String
  description String?
  type        String   @default("GENERAL") // "TOUR", "VENUE", "GENERAL"
  imageUrls   String[]

  // Inverse Relations (Tracking where these galleries are used)
  tourFairs  Fair[] @relation("TourGallery")
  venueFairs Fair[] @relation("VenueGallery")
  fairFairs  Fair[] @relation("FairGallery")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// --- 2. THE MAIN ENTITY (FAIR) ---

model Fair {
  id String @id @default(uuid())

  // Basic Info
  name        String
  slug        String  @unique // For URL: /fairs/expo-2026
  description String
  summary     String?
  venue       String? // e.g. "Istanbul Expo Center"
  website     String?

  // --- NEW FIELD ---
  category String? // e.g. "Tekstil", "Mobilya"
  type     String? // e.g. "Uluslararası", "Ulusal"

  // Dates
  startDate DateTime
  endDate   DateTime

  // Status & Flags
  status              String  @default("Beklemede") // Beklemede, Aktif, Pasif
  isPublished         Boolean @default(false)
  isFeatured          Boolean @default(false)
  isSectoral          Boolean @default(false)
  isDefiniteDeparture Boolean @default(false)

  // Media (Single Images)
  logoUrl         String?
  bannerUrl       String?
  displayOnBanner Boolean @default(false)

  // Tags (String Arrays)
  products     String[]
  services     String[]
  freeServices String[]

  // --- RELATIONS ---

  // 1. Accommodation (Link to Library)
  hotelId String?
  hotel   Hotel?  @relation(fields: [hotelId], references: [id])

  // 2. Image Collections (Links to Library)
  tourGalleryId String?
  tourGallery   Gallery? @relation("TourGallery", fields: [tourGalleryId], references: [id])

  venueGalleryId String?
  venueGallery   Gallery? @relation("VenueGallery", fields: [venueGalleryId], references: [id])

  fairGalleryId String?
  fairGallery   Gallery? @relation("FairGallery", fields: [fairGalleryId], references: [id])

  // 3. Nested Data (Owned by Fair)
  packages TravelPackage[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// --- 3. NESTED DETAILS ---

model TravelPackage {
  id          String  @id @default(uuid())
  name        String // e.g. "Economic Package"
  duration    String? // e.g. "3 Nights 4 Days"
  description String?

  priceSingle Float?
  priceDouble Float?

  // Parent Relation
  fairId String
  fair   Fair   @relation(fields: [fairId], references: [id], onDelete: Cascade)

  // Children
  activities Activity[]
}

model Activity {
  id          String @id @default(uuid())
  dayNumber   Int
  description String

  // Parent Relation
  packageId     String
  travelPackage TravelPackage @relation(fields: [packageId], references: [id], onDelete: Cascade)
}

// --- 4. CAMPAIGNS ---
model Campaign {
  id          String   @id @default(uuid())
  name        String
  description String
  isPublished Boolean
  image       String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// --- 5. CONTACT ---
model Message {
  id             String   @id @default(uuid())
  name           String
  email          String
  subject        String?
  contactMessage String?
  from           String?
  isRead         Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @default(now())
}
